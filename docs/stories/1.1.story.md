# Story 1.1: Project Initialization & Deployment

## Status

**Done**

## Story

**As a** utvikler,  
**I want** et fungerende Next.js prosjekt med TypeScript deployet til Vercel,  
**so that** jeg har en solid base å bygge videre på.

## Acceptance Criteria

1. Next.js 14+ prosjekt opprettet med App Router og TypeScript strict mode
2. pnpm konfigurert som package manager
3. Prosjektstruktur følger Next.js konvensjoner (`app/`, `components/`, `lib/`)
4. ESLint og Prettier konfigurert for konsistent kode
5. Git repository initialisert med .gitignore
6. Prosjektet deployet til Vercel med automatisk deploy på push
7. Health check endpoint (`/api/health`) returnerer `{ status: "ok" }`
8. README med prosjektbeskrivelse og setup-instruksjoner

## Tasks / Subtasks

- [x] **Task 1: Opprett Next.js prosjekt med create-payload-app** (AC: 1, 2)
  - [x] Kjør `pnpm create payload-app@latest devhub` med PostgreSQL adapter
  - [x] Velg TypeScript, App Router, og pnpm som package manager
  - [x] Verifiser at prosjektet starter lokalt med `pnpm dev`
  - [x] Verifiser at Payload admin er tilgjengelig på `/admin`

- [x] **Task 2: Konfigurer TypeScript strict mode** (AC: 1)
  - [x] Oppdater `tsconfig.json` med `"strict": true`
  - [x] Legg til `"noUncheckedIndexedAccess": true` for ekstra sikkerhet
  - [x] Verifiser at `pnpm type-check` passerer uten feil

- [x] **Task 3: Etabler prosjektstruktur** (AC: 3)
  - [x] Opprett mappestruktur iht. arkitektur (se Dev Notes)
  - [x] Opprett placeholder-filer for å etablere strukturen
  - [x] Legg til `.gitkeep` i tomme mapper som skal versjoneres

- [x] **Task 4: Konfigurer ESLint og Prettier** (AC: 4)
  - [x] Installer ESLint plugins: `@typescript-eslint/eslint-plugin`, `eslint-plugin-react`
  - [x] Installer Prettier: `prettier`, `eslint-config-prettier`
  - [x] Opprett `.prettierrc` med prosjektets kodestil
  - [x] Opprett/oppdater `.eslintrc.json` med TypeScript og React regler
  - [x] Legg til scripts i `package.json`: `lint`, `lint:fix`, `format`
  - [x] Kjør `pnpm lint:fix` og fiks eventuelle feil

- [x] **Task 5: Initialiser Git repository** (AC: 5)
  - [x] Kjør `git init` (hvis ikke allerede gjort av create-payload-app)
  - [x] Opprett/verifiser `.gitignore` inkluderer: `node_modules/`, `.env*`, `.next/`, `.vercel/`
  - [x] Lag initial commit: `feat: initialize devhub project with payload cms`

- [x] **Task 6: Opprett Health Check Endpoint** (AC: 7)
  - [x] Opprett `app/api/health/route.ts`
  - [x] Implementer GET handler som returnerer `{ status: "ok", timestamp: ISO-string }`
  - [x] Verifiser at endpointet fungerer: `curl http://localhost:3000/api/health`

- [x] **Task 7: Opprett README.md** (AC: 8)
  - [x] Skriv prosjektbeskrivelse (DevHub - utvikler-community plattform)
  - [x] Dokumenter prerequisites (Node.js 18+, pnpm 8+)
  - [x] Dokumenter setup-steg (clone, install, env, dev)
  - [x] Inkluder tilgjengelige scripts
  - [x] Legg til tech stack oversikt

- [x] **Task 8: Opprett .env.example** (AC: 8)
  - [x] Dokumenter alle nødvendige environment variables
  - [x] Inkluder kommentarer som forklarer hver variabel
  - [x] Inkluder placeholder-verdier der mulig

- [x] **Task 9: Deploy til Vercel** (AC: 6)
  - [x] Opprett Vercel-prosjekt via CLI eller dashboard
  - [x] Koble til GitHub repository
  - [x] Konfigurer environment variables i Vercel
  - [x] Verifiser at deploy kjører automatisk ved push
  - [x] Test at produksjons-URL fungerer
  - [x] Verifiser health check endpoint i produksjon

- [x] **Task 10: Verifiser og dokumenter** (AC: alle)
  - [x] Kjør gjennom alle AC og verifiser at de er oppfylt
  - [x] Oppdater README med Vercel deployment URL
  - [x] Lag final commit med eventuelle justeringer

## Dev Notes

### Arkitektur-beslutning: Starter Template
[Source: docs/architecture.md#Starter Template]

> **Beslutning:** Bruk `create-payload-app` som base, deretter manuell integrasjon av Prisma, Clerk, og shadcn/ui.

Dette gir Payload CMS ferdig konfigurert med Next.js 14+ og PostgreSQL adapter. Prisma legges til i Story 1.2.

### Tech Stack Versjonskrav
[Source: docs/architecture.md#Tech Stack]

| Teknologi | Versjon | Formål |
|-----------|---------|--------|
| Next.js | 14.x+ | App Router, Server Components |
| TypeScript | 5.x | Strict mode påkrevd |
| pnpm | 8.x | Package manager (rask, streng) |
| Node.js | 18+ | LTS versjon |
| ESLint | 8.x | Kodekvalitet |
| Prettier | 3.x | Kodeformatering |

### Prosjektstruktur (Målbilde)
[Source: docs/architecture.md#Unified Project Structure]

```
devhub/
├── app/                  # Next.js App Router
│   ├── (marketing)/      # Landing page (minimal layout)
│   ├── (app)/            # Main app (full layout) - SENERE
│   ├── admin/            # Payload CMS admin
│   └── api/
│       └── health/       # Health check endpoint
├── components/           # React Components
│   └── ui/               # shadcn/ui - SENERE
├── lib/                  # Backend/shared code
│   └── utils/            # Hjelpefunksjoner
├── payload/              # Payload CMS config (generert)
├── prisma/               # Prisma schema - STORY 1.2
├── public/               # Static assets
├── docs/                 # Dokumentasjon
├── .env.example
├── .env.local            # Lokal config (gitignored)
├── .eslintrc.json
├── .prettierrc
├── middleware.ts         # Clerk middleware - STORY 1.4
├── next.config.mjs
├── package.json
├── tailwind.config.ts
└── tsconfig.json
```

**MERK:** Noen mapper opprettes i senere stories. For nå, fokuser på grunnstrukturen.

### ESLint Konfigurasjon
[Source: docs/architecture.md#Tech Stack, #Coding Standards]

```json
{
  "extends": [
    "next/core-web-vitals",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "error"
  }
}
```

### Prettier Konfigurasjon
[Source: docs/architecture.md#Coding Standards]

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100
}
```

### package.json Scripts
[Source: docs/architecture.md#Development Workflow]

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "format": "prettier --write \"**/*.{ts,tsx,json,md}\"",
    "type-check": "tsc --noEmit"
  }
}
```

### Health Check Endpoint Implementasjon
[Source: docs/architecture.md#Monitoring and Observability]

```typescript
// app/api/health/route.ts
export async function GET() {
  return Response.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
  });
}
```

**MERK:** I senere stories utvides dette til å sjekke database-tilkobling.

### Vercel Deployment
[Source: docs/architecture.md#Deployment Architecture]

| Setting | Verdi |
|---------|-------|
| Build Command | `pnpm build` |
| Output Directory | `.next` |
| Install Command | `pnpm install` |
| Node Version | 18.x |
| Region | Frankfurt (eu-central-1) |

### Environment Variables (Minimum for Story 1.1)
[Source: docs/architecture.md#External APIs]

```bash
# .env.example

# Database (Vercel Postgres) - STORY 1.2
# DATABASE_URL=
# POSTGRES_URL=

# Payload CMS
PAYLOAD_SECRET=your-secret-here-min-32-chars
NEXT_PUBLIC_SERVER_URL=http://localhost:3000

# Vercel (auto-injected)
# VERCEL_URL=
```

### Git Commit Konvensjon
[Source: docs/architecture.md#Development Workflow]

```
feat: add snippet creation form
fix: resolve auth redirect loop
refactor: reorganize services
docs: update README
```

### Læringsprosjekt-spesifikke Krav
[Source: docs/prd.md#Non-Functional Requirements]

- **NFR1:** All kode skal være grundig kommentert for læringsformål
- **NFR3:** Komplekse konsepter skal dokumenteres inline med forklaringer

**Praktisk:** Legg til kommentarer som forklarer "hvorfor", ikke bare "hva".

## Testing

### Testlokasjon
[Source: docs/architecture.md#Testing Strategy]

```
tests/
├── setup.ts                 # Global setup
└── integration/
    └── api/
        └── health.test.ts   # Health check test
```

### Testing for denne story

**Manuell verifisering (tilstrekkelig for Story 1.1):**
1. `pnpm dev` starter uten feil
2. `http://localhost:3000` viser Payload welcome/admin
3. `http://localhost:3000/api/health` returnerer JSON med status "ok"
4. `pnpm lint` passerer
5. `pnpm type-check` passerer
6. Vercel deployment URL fungerer

**Valgfritt - Integrasjonstest:**
```typescript
// tests/integration/api/health.test.ts
import { describe, it, expect } from 'vitest';

describe('/api/health', () => {
  it('returns ok status', async () => {
    const response = await fetch('http://localhost:3000/api/health');
    const data = await response.json();
    
    expect(response.status).toBe(200);
    expect(data.status).toBe('ok');
    expect(data.timestamp).toBeDefined();
  });
});
```

**MERK:** Vitest settes opp ordentlig i en senere story. For nå er manuell testing tilstrekkelig.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-21 | 0.1 | Initial story draft | SM Bob |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 via Cursor IDE

### Debug Log References
- Git credential issue resolved by switching from HTTPS to SSH
- pnpm store location conflict resolved with full permissions

### Completion Notes List
- All 10 tasks completed successfully
- All 8 Acceptance Criteria verified
- Project deployed to Vercel: https://devhub-virid.vercel.app
- Health check endpoint verified in production
- Monorepo structure adopted (docs + code in same repo)

### File List
**Created:**
- `src/app/api/health/route.ts` - Health check endpoint
- `src/components/.gitkeep` - Components directory placeholder
- `src/components/ui/.gitkeep` - UI components placeholder  
- `src/lib/utils/index.ts` - Utility functions with cn()
- `src/app/(app)/.gitkeep` - App route group placeholder
- `prisma/.gitkeep` - Prisma directory placeholder

**Modified:**
- `tsconfig.json` - Added noUncheckedIndexedAccess
- `package.json` - Added type-check, lint:fix, format scripts
- `.prettierrc.json` - Updated to match architecture spec
- `eslint.config.mjs` - Added prettier, stricter rules
- `README.md` - Complete project documentation
- `.env.example` - Comprehensive env var documentation
- `src/app/my-route/route.ts` - Fixed unused variables lint error

---

## QA Results

### Review Date: 2026-01-21

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: GOOD** - The implementation demonstrates solid foundational setup with excellent attention to documentation for learning purposes, aligning well with the project's NFR1 requirement. Code is clean, well-commented, and follows established conventions.

**Highlights:**
- Exceptional inline documentation (health endpoint, utils, eslint config) with clear "why" explanations
- TypeScript configured with maximum strictness (`strict: true`, `noUncheckedIndexedAccess: true`)
- ESLint config includes rationale comments explaining each rule decision
- Proper handling of unused variables with underscore prefix convention (`_request`, `_payload`)

### Refactoring Performed

None required - code quality is appropriate for a foundation story.

### Compliance Check

- Coding Standards: ✓ Follows architecture-specified ESLint/Prettier configuration
- Project Structure: ✓ Matches unified project structure from architecture.md (src/app, src/components, src/lib)
- Testing Strategy: ✓ Manual testing appropriate per story definition; test infrastructure (Vitest, Playwright) ready
- All ACs Met: ✓ All 8 acceptance criteria verified

### Acceptance Criteria Verification

| AC | Status | Evidence |
|----|--------|----------|
| 1. Next.js 14+ with App Router, TS strict | ✓ | Next.js 15.4.10, `tsconfig.json` has `strict: true` |
| 2. pnpm configured | ✓ | `pnpm-lock.yaml`, `engines` in package.json |
| 3. Project structure | ✓ | `app/`, `components/`, `lib/` directories exist |
| 4. ESLint and Prettier | ✓ | `eslint.config.mjs`, `.prettierrc.json` properly configured |
| 5. Git repository with .gitignore | ✓ | `.gitignore` includes node_modules, .env*, .next/, .vercel/ |
| 6. Deployed to Vercel | ✓ | Live at https://devhub-virid.vercel.app |
| 7. Health check endpoint | ✓ | `/api/health` returns `{ status: "ok", timestamp }` |
| 8. README with setup instructions | ✓ | Comprehensive README.md with tech stack, setup, scripts |

### Improvements Checklist

- [x] All acceptance criteria met
- [x] Documentation follows learning project requirements (NFR1)
- [x] Lint passes with no errors
- [x] Type-check passes with no errors
- [ ] **Optional**: Update `src/app/(frontend)/layout.tsx` metadata from generic Payload template to DevHub branding
- [ ] **Optional**: Consider removing or documenting `src/app/my-route/route.ts` example route
- [ ] **Note**: Multiple lockfiles warning (workspace + project) - consider consolidating in future

### Security Review

N/A for this story - no authentication or sensitive data handling. Security will be addressed in Story 1.4 (Clerk integration).

### Performance Considerations

Appropriate for initialization story. Health check endpoint is lightweight and suitable for monitoring.

### Files Modified During Review

None - no refactoring required.

### Gate Status

Gate: **PASS** → `docs/qa/gates/1.1-project-initialization-deployment.yml`

### Recommended Status

✓ **Ready for Done** - All acceptance criteria met, code quality is good, no blocking issues.
